all:
  vars:
  children:
    hypervisor_1:
      vars:
        # ----
        ## Hypervisor dependent

        ## Provider URI is required. It is the uri of the KVM server.
        ## In case the KVM server and the terraform_node correspond, retain
        ## the default "qemu:///system", else use the form:
        ##
        ##      qemu+ssh://USER@IP/system
        #
        provider_uri: "qemu:///system"

        ## BASTION SECTION: in case the terraform_node and qemu/kvm server differ,
        ## you should enable the bastion. This will enable the use of the kvm server
        ## as jumphost to enter the VMs via SSH.
        ##
        ## terraform_bastion_enabled: Bool, required argument.
        #
        terraform_bastion_enabled: False
        ## terraform_bastion_host, is terraform_bastion_enabled is True, should correspond to the IP of
        ## the qemu/kvm server.
        #
        # terraform_bastion_host: 192.168.1.2
        # terraform_bastion_password: password
        # terraform_bastion_port: 22
        # terraform_bastion_user: root
        # ----
        #
        ## list of eventual single or multiple bastion/jump hops necessar to reach the
        ## VMs. if terraform_bastion_enabled is True, AT LEAST one jump is ncessary
        ## and should correspond to the terraform_node user@IP.
        #
        ## This value can be set also if terraform_bastion_enabled is False, this way
        ## it is possible to specify a jump host independently from the terraform node.
        ansible_jump_hosts:
          - {user: root, host: bastion_2.lan, port: 2222}
          - {user: root, host: bastion.lan, port: 22}
          - {user: bastion, host: management, port: 50363}
        #
        # ----
        ## Source image:
        # in this example, we setup the default image to a centos8 image,
        # this can be overwritten on a per-group or per-host level.
        disk_source: "~/VirtualMachines/centos8-terraform.qcow2"
        pool_name: default
        # ----
        #
        ## These are the ssh infos that are necessary to access the
        ## basic VM source image.
        ssh_password: root
        ssh_port: 22
        ssh_user: root
        # ----
        ##
        # Default ssh public key location.
        # ssh_public_key_file: '~/.ssh/id_rsa.pub'
      hosts:
        #
        # ----
        ## Terraform node is required; it is the IP of the machine
        ## that performs the terraform tasks. The default value of
        ## 127.0.0.1 indicates that the machine that performs terraform
        ## tasks is the same that launches the ansible playbook.
        ##
        ## When using 127.0.0.1 for the terraform_node, it is advisable to also
        ## set ansible_connection to local, so it does not use ssh for localhost.
        ##
        ## In case the terraform machine is NOT the local machine, put here the
        ## IP/hostname of the terraform node.
        #
        # ----
        terraform_node:
          ansible_host: remote_terraform_node.test.com
      children:
        master_nodes:
          hosts:
            # Here the list of VMs that we want to create and provision.

            host-vm-1:

              ## Host specific resources
              #
              ## It is possible to specify per-VM disk source.
              ## This is useful for mixed environments with
              ## multiple distributions.
              # disk_source: "~/VirtualMachines/centos8-terraform.qcow2"
              os_family: RedHat
              cpu: 4
              memory: 1024
              # This is the network resource where you want
              # to assign the default NAT network, libvirt
              # creates this "default" when installing, being the
              # 192.168.122.0/24 subnet.

              # ----
              ## Mount points are optionals, the folder are
              ## exposed to the guest via 9p fs, make sure
              ## the guest supports it.
              ##
              ## It can be 1 value or more, depending on your needs.
              ##
              #
              # mount_points:
              #   - {src: /tmp, dest: mnt }
              #   - {src: /home, dest: home }
              # ----

              # ----
              ## ansible_host is declared here as a mean for ansible
              ## to continue the VM provisioning after the terraform apply.
              #
              ansible_host: 172.16.0.156
              # ----
              ## Network declaration:
              ##
              ## Declare each device you want to add inside the network_interfaces
              ## dictionary.
              ## Remember that THE ORDER OF DECLARATION is IMPORTANT, the NAT device
              ## should always be present (unless you can control your DHCP leases
              ## for the external devices) and that should be the FIRST device.
              ## It is important because it's the way the role has to communicate
              ## with the VM **BEFORE** setting up all the userspace networks.
              ##
              ## Other interfaces are of 2 types: macvtap, bridge
              ##
              ## the default_route should be assigned to ONLY ONE interface to
              ## function properly.
              ##
              ## if not set it's equal to False.
              ##
              ##      Structure:
              ## name_of_network:
              ##   type:  ...  # mandatory
              ##   ip:    ...  # mandatory
              ##   gw:    ...  # mandatory
              ##   dns:   ...  # optional
              ##    - dns1
              ##    - dns2
              ##    ...
              ##   mac_address: ...   # optional
              ##   default_route: ... # at least one true mandatory, false is optional.
              # ----
              network_interfaces:
                iface_1:
                  name: nat
                  type: nat
                  ip: 192.168.122.155
                  gw: 192.168.122.1
                  dns:
                    - 192.168.122.1
                  mac_address: "AA:BB:CC:11:24:68"
                iface_2:
                  name: ens1
                  type: macvtap
                  ip: 192.168.1.124
                  gw: 192.168.1.1
                  dns:
                    - 1.1.1.1
                    - 8.8.8.8
                  default_route: True
                iface_3:
                  name: EXT_BRIDGE
                  type: bridge
                  ip: 172.16.0.156
                  gw: 172.16.0.1
                  dns:
                    - 172.16.0.1

              # ----
              ## Default ssh public key location.
              ## If you need a specific ssh key for a specific host
              ## you can declare it here, to be host specific instead
              ## of global.
              #
              #ssh_public_key_file: '~/.ssh/id_rsa.pub'
              # ----

              # ----
              ## this parameter is optional. Specifying this parameter
              ## will change the VM password during the initialization of it.
              ##
              ## This will then be used in the provisioning section if no ssh-public-key
              ## is found.
              ##
              ## It is advisable to use ansible-vault for this section.
              #
              # set_new_password: test_psk
              # ----
              # ----
              ## It is possible to specify custom commands that should be executed
              ## on a VM **BEFORE** ansible provisioning starts. This can be useful
              ## for cases where python3 is not installed by default for example, or
              ## to setup static IPs for bridge/macvtap interfaces.
              #
              ## It supports using jinja2 syntax and variables.
              #
              terraform_custom_provisioners:
                - "echo {{ ansible_host }} > /tmp/test_provisioning_success.log"
          vars:
              ## It is possible to specify per-GROUP disk source.
              ## This is useful for mixed environments with
              ## multiple distributions.
              # disk_source: "~/VirtualMachines/centos8-terraform.qcow2"

              # ----
              ## Default ssh public key location.
              ## If you need a specific ssh key for a specific group of hosts
              ## you can declare it here, to be GROUP-SPECIFIC instead
              ## of global.
              #
              #ssh_public_key_file: '~/.ssh/id_rsa.pub'
              # ---

              # ----
              ## this parameter is optional. Specifying this parameter
              ## will change the password during the initialization of the VM
              ## GROUP-SPECIFIC.
              ##
              ## This will then be used in the provisioning section if no ssh-public-key
              ## is found.
              ##
              ## It is advisable to use ansible-vault for this section.
              #
              # set_new_password: test_psk
              # ----

              ## Here we can provide a GROUP-SPECIFIC default
              ## for the resources (cpu, ram, network...)
              ## so if all nodes in a group are the same size
              ## it is possible to deduplicate a lot of settings.
              # cpu: 1
              # memory: 1024
              # mount_points:
              #   - {src: /tmp, dest: mnt }
              #   - {src: /home, dest: home }
        slave_nodes:
          hosts:
            host-vm-2:
              os_family: RedHat
              ansible_host: 192.168.122.200
              network_interfaces:
                iface_1:
                  type: nat
                  ip: 192.168.122.200
                  gw: 192.168.122.1
                  dns:
                    - 192.168.122.1
                  mac_address: "AA:BB:CC:12:25:69"
                  default_route: True
              cpu: 2
              memory: 1024
            host-vm-3:
              os_family: Suse
              disk_source: "~/VirtualMachines/opensuse15.2-terraform.qcow2"
              ansible_host: 192.168.122.201
              network_interfaces:
                iface_1:
                  type: nat
                  ip: 192.168.122.201
                  gw: 192.168.122.1
                  dns:
                    - 192.168.122.1
                  mac_address: "AA:BB:CC:11:25:69"
                  default_route: True
              cpu: 2
              memory: 1024
          vars:
            # ...
            # hypervisor_2:
            #   vars:
            #   children:
            #     master_nodes:
            #     slave_nodes:
    #
    ## ----
    #
    # hypervisor_2
    #   vars:
    #     ...
    #   children:
    #     host:
    #       terraform_node:
    #         ansible_host: 127.0.0.1
    #     group_1:
    #       hosts:
    #         ...
    #       vars:
    #         ...
    #     group_2:
    #       hosts:
    #       ...
    #       vars:
    #       ...
    # hypervisor_3
    # ...
